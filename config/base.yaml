# Configuration for QAOps Slack Alarm Analyzer
# This file defines product-specific settings for alarm monitoring and Slack integration

# Global settings
kpi_reports:
  # Slack channel ID where KPI reports will be published
  # Leave empty or comment out to disable automatic publishing
  slack_channel_id: "C09S6NBBBQF"

products:
  # SEND Product Configuration
  SEND:
    # Environment-specific Slack channel configuration
    # Each environment routes alarm notifications to its designated Slack channel
    envs:
      prod:
        slack_channel_id: "C0585442Z39"
      uat:
        slack_channel_id: "C03JJLHL5K8"

    # Alarm filtering and ignore rules configuration
    alarms:
      ignore:
        - name: "AWS Notification Message"
          path: "files.name"

        - name: "pn-delivery-versioning-v1v21-sendnewnotification-lambda-LogInvocationError"
          path: "attachments.title.alarm_name"
          reason: "L'analisi dell'allarme non aggiunge nulla di rilevante rispetto all'analisi del contemporaneo pn-delivery-B2B-ApiGwAlarm"
                 
        - name: "pn-delivery-versioning-v1v2-getnotification-lambda-LogInvocationErrors-Alarm"
          path: "attachments.title.alarm_name"
          reason: "L'analisi dell'allarme non aggiunge nulla di rilevante rispetto all'analisi del contemporaneo pn-delivery-B2B-ApiGwAlarm"
          
        - name: "pn-Confinfo-SMS-MonthToDateSpentUSD"
          path: "attachments.title.alarm_name"
          reason: "ALARM: pn-Confinfo-SMS-MonthToDateSpentUSD. L'allarme riguarda le spese mensili in sms e viene monitorato direttamente dal gruppo Infra. Thread Slack: https://pagopaspa.slack.com/archives/C087KRMD16E/p1761312793655509Connect"
          
        - name: "pn-bff-WEB-payment-comp-5xx-ApiGwAlarm"
          path: "attachments.title.alarm_name"
          reason: "SEND contatto l'ente creditore per avere informazioni sul pagamento e per farlo passa anche per il downstream PagoPA: Il cittadino accede alla pagina di pagamento -> SEND invoca PagoPA -> PagoPA invoca l'ente mittente pertanto la responsabilità dei 500 è del servizio PagoPA e non di SEND"
        
        - name: "pn-web-logout-api-ErrorAlarm"
          path: "attachments.title.alarm_name"
          # validity:
          #   periods:
          #     - start: "2025-09-30"
          #       end: "2025-11-06"
          reason: "Fino al prossimo rilascio in prod  (6 novembre 2025) Piattaforma Notifiche: GA25Q4.A - Jira"

        - name: "workday-SLAViolations-SendPaperAr890-Alarm"
          path: "attachments.title.alarm_name"
          # validity:
          #   hours:
          #     - start: "01:00"
          #       end: "05:00"
          reason: "Questi allarmi scattano ogni giorno alle  3.00 UTC. Si tratta di allarmi periodici ed eventuali problemi associati alle metriche che misurano vengono verificati la mattina poco prima dello SU di Send. Nello specifico bisogna assicurarsi che: il numero di SLA di validazione in Violazione sia pari a 0; il numero di SLA SendPec non superi 4; Gli altri valori possono essere ignorati"

        - name: "workday-SLAViolations-Refinement-Alarm"
          path: "attachments.title.alarm_name"
          # validity:
          #   hours:
          #     - start: "01:00"
          #       end: "05:00"
          reason: "Questi allarmi scattano ogni giorno alle  3.00 UTC. Si tratta di allarmi periodici ed eventuali problemi associati alle metriche che misurano vengono verificati la mattina poco prima dello SU di Send. Nello specifico bisogna assicurarsi che: il numero di SLA di validazione in Violazione sia pari a 0; il numero di SLA SendPec non superi 4; Gli altri valori possono essere ignorati"

        - name: "workday-SLAViolations-SendAmr-Alarm"
          path: "attachments.title.alarm_name"
          # validity:
          #   hours:
          #     - start: "01:00"
          #       end: "05:00"
          reason: "Questi allarmi scattano ogni giorno alle  3.00 UTC. Si tratta di allarmi periodici ed eventuali problemi associati alle metriche che misurano vengono verificati la mattina poco prima dello SU di Send. Nello specifico bisogna assicurarsi che: il numero di SLA di validazione in Violazione sia pari a 0; il numero di SLA SendPec non superi 4; Gli altri valori possono essere ignorati"

        - name: "workday-SLAViolations-SendPec-Alarm"
          path: "attachments.title.alarm_name"
          # validity:
          #   hours:
          #     - start: "01:00"
          #       end: "05:00"
          reason: "Questi allarmi scattano ogni giorno alle  3.00 UTC. Si tratta di allarmi periodici ed eventuali problemi associati alle metriche che misurano vengono verificati la mattina poco prima dello SU di Send. Nello specifico bisogna assicurarsi che: il numero di SLA di validazione in Violazione sia pari a 0; il numero di SLA SendPec non superi 4; Gli altri valori possono essere ignorati"

        # DLQ Alarms - These alarms are triggered when messages enter DLQ queues
        - name: "pn-delivery_push_actions-DLQ-HasMessage"
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-delivery_push_inputs-DLQ-HasMessage"
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-ec-tracker-cartaceo-errori-queue-DLQ-HasMessage"
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-ec-tracker-pec-errori-queue-DLQ-HasMessage"
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-external_channel_to_paper_channel_dry_run-DLQ-HasMessage"
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-national_registry_gateway_inputs-DLQ-HasMessage"
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-ss-main-bucket-events-queue-DLQ-HasMessage"
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-ss-staging-bucket-events-queue-DLQ-HasMessage"
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-ss-transformation-raster-queue-DLQ-HasMessage"
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-ss-transformation-sign-and-timemark-queue-DLQ-HasMessage"
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-safestore_to_deliverypush-DLQ-HasMessage"
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-ec-tracker-email-errori-queue-DLQ-HasMessage"
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-f24_internal_pdf_generator-DLQ-HasMessage" # NON PRESENTE NELLE'ELENCO DA IGNORARE
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-national_registries_certificate_DLQ-HasMessage" # NON PRESENTE NELLE'ELENCO DA IGNORARE
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-opensearch-low-storage"
          path: "attachments.title.alarm_name"
          reason: "Questo allarme va gestito direttamente dal gruppo Infra"

        - name: "pn-ec-pec-scaricamento-esiti-queue-DLQ-HasMessage" # NON PRESENTE NELLE'ELENCO DA IGNORARE
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"
          
        - name: "pn-ec-cartaceo-batch-queue-HasOldMessage" # NON PRESENTE NELLE'ELENCO DA IGNORARE
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-ec-sms-batch-queue-HasOldMessage" # NON PRESENTE NELLE'ELENCO DA IGNORARE
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"
        
        - name: "pn-ec-tracker-sms-errori-queue-DLQ-HasMessage"
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-ec-availabilitymanager-queue-DLQ-HasMessage"
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"

        - name: "pn-ss-transformation-sign-queue-DLQ-HasMessage"
          path: "attachments.title.alarm_name"
          reason: "Questi allarmi sono associati all'ingresso di messaggi in DLQ che vengono gestite quotidianamente, inoltre l'allarme potrebbe essere innescato semplicamente dall'esecuzione di un dump o redrive sulla coda stessa"
          
        # - name: "pn-external-channel-PecNamirial-multipleReceipt-alarm"
        #   path: "attachments.title.alarm_name"
        #   reason: "L'allarme non scatta in presenza di determinati termini nei log (es. Error, Fatal) ma è direttametne collegato alla metrica 'multipleReceipt' che misura la numerosità dei duplicati nelle ricevute PEC (accettazione e ricezione). L'allarme non è associato a problematiche che impattano i cittadini. Nota: In concomitanza all'attivazione di questo allarme potrebbero presentarsi diversi messaggi nella DLQ pn-ec-tracker-pec-errori-queue-DLQ.fifo e che potranno essere gestiti (rimossi) tramite lo script di automazione check_safestorage_dlq."
        #   validity:
        #     start: "2025-19-09"

        # JWKS Cache Refresh Lambda Errors
        - name: "pn-jwksCacheRefreshLambda-LogInvocationErrors-Alarm"
          path: "attachments.title.alarm_name"
          reason: "Attività periodiche eseguite dai CAF (presumibilmente reboot dei servizi) con conseguenti errori di connection refused/timeout. Mai alle ore 5.35 utc e 12.35 utc o in eventuali nuovi casi simili. Altre occorrenze individuate: 0.11 utc, 21.06 utc"

        # =====================================================================
        # ESEMPI DI IGNORE RULES
        # =====================================================================
        # Ogni regola può specificare:
        # - name: nome esatto dell'allarme o pattern
        # - path: percorso del campo dove cercare (default: "*" = tutti i campi)
        #         Esempi: "attachments.title.alarm_name", "files.name", "text"
        # - environments: lista di ambienti dove la regola si applica (opzionale, default: tutti)
        # - reason: spiegazione del perché la regola esiste (opzionale ma consigliato)
        # - validity: quando la regola è valida (opzionale)
        # - exclusions: quando la regola NON è valida (opzionale)

        # Esempio 1: Regola sempre valida
        # - name: "AWS Notification Message"
        #   path: "files.name"
        #   reason: "Notifiche AWS non rilevanti"

        # Esempio 2: Regola valida solo fino a una data
        # - name: "Temporary-Fix-Alert"
        #   path: "attachments.title"
        #   validity:
        #     periods:
        #       - end: "2025-12-31"
        #   reason: "Valida fino al deploy previsto"

        # Esempio 3: Regola valida solo di notte
        # - name: "Night-Batch-Alert"
        #   path: "attachments.title"
        #   validity:
        #     hours:
        #       - start: "01:00"
        #         end: "05:00"
        #   reason: "Batch notturni previsti"

        # Esempio 4: Regola valida sempre tranne i weekend
        # - name: "Weekday-Only-Alert"
        #   path: "attachments.title"
        #   exclusions:
        #     weekdays: ["saturday", "sunday"]
        #   reason: "Ignora solo nei giorni lavorativi"

        # Esempio 5: Regola con validity e exclusions
        # - name: "Office-Hours-Alert"
        #   path: "attachments.title"
        #   validity:
        #     weekdays: [0, 1, 2, 3, 4]  # Lun-Ven
        #     hours:
        #       - start: "09:00"
        #         end: "18:00"
        #   exclusions:
        #     hours:
        #       - start: "12:30"
        #         end: "14:00"
        #   reason: "Orario ufficio esclusa pausa pranzo"

        # Esempio 6: Environment-specific con placeholder
        # - name: "API-Error-[#env#]"
        #   path: "attachments.title"
        #   environments: ["prod", "uat"]
        #   reason: "Solo in prod e uat"

        # Per più esempi, vedere: config/ignore_rules_examples_v2.yaml
        # Per documentazione completa: docs/IGNORE_RULES_GUIDE.md

      # OnCall alarms configuration
      oncall:
        # Slack channel ID where oncall alarms are posted (same as prod for SEND)
        channel_id: "C0585442Z39"
        # Regex pattern to identify oncall alarms in alarm names
        # For SEND: alarms with "oncall" prefix (case insensitive)
        pattern: "^oncall"

  # INTEROP Product Configuration
  INTEROP:
    # Environment-specific Slack channel configuration for INTEROP product
    envs:
      prod:
        # Production environment
        slack_channel_id: "C0472QPG5D2"
      test:
        # Test environment 
        slack_channel_id: "C04708Y1QP5"
      att:
        # Attestazione
        slack_channel_id: "C06LQ7Y8B17"
      catalog:
        # Attestazione
        slack_channel_id: "C09RVCSL4BS"

    # Alarm filtering and ignore rules configuration for INTEROP
    alarms:
      ignore:
        - name: "AWS Notification Message"
          path: "files.name"

      # OnCall alarms configuration for INTEROP
      # OnCall alarms are urgent alarms that require immediate attention
      # For INTEROP, oncall messages are posted to a dedicated Slack channel
      oncall:
        # Dedicated Slack channel ID for INTEROP oncall alarms
        # TODO: Replace with actual dedicated oncall channel ID
        channel_id: "C05G8LFEUAF"  # Currently set to prod channel - update with dedicated oncall channel
        # Regex pattern to identify oncall alarms in alarm names
        # For INTEROP: alarms with "on-call" prefix (case insensitive)
        pattern: "^on-call"
